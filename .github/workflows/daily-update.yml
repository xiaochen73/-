name: æ¯æ—¥æ›´æ–°å…»ç”Ÿå†…å®¹

on:
  schedule:
    # è®¡åˆ’ä»»åŠ¡ï¼šæ¯å¤©UTCæ—¶é—´16:00è¿è¡Œï¼Œå³åŒ—äº¬æ—¶é—´ 00:00[citation:6]
    # æ³¨æ„ï¼šGitHub Actionsçš„cronåŸºäºUTCæ—¶é—´ï¼Œä¸æ”¯æŒç§’çº§è®¾å®š[citation:6]
    - cron: '0 16 * * *'
  workflow_dispatch: # å…è®¸åœ¨ç½‘é¡µæ‰‹åŠ¨è§¦å‘

jobs:
  generate-and-deploy:
    runs-on: ubuntu-latest
    # è®¾ç½®è¿è¡Œç¯å¢ƒæ—¶åŒºä¸ºä¸Šæµ·ï¼Œè®©è„šæœ¬å†…æ—¥æœŸè·å–æ›´å‡†ç¡®[citation:2]
    env:
      TZ: Asia/Shanghai
    steps:
      - name: ğŸ›ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          # æˆäºˆå·¥ä½œæµå†™å…¥ä»“åº“çš„æƒé™ï¼Œè¿™æ˜¯è§£å†³â€œpermission deniedâ€çš„å…³é”®ï¼[citation:10]
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: âš™ï¸ è®¾ç½®Node.jsç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: '18.x' # æŒ‡å®šNode.jsç‰ˆæœ¬ï¼Œä¿æŒç¯å¢ƒä¸€è‡´

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm install axios # å®‰è£…è„šæœ¬æ‰€éœ€çš„axiosåº“

      - name: ğŸƒ ç”Ÿæˆä»Šæ—¥å…»ç”Ÿå†…å®¹
        # å°†GitHubä»“åº“Secretsä¸­è®¾ç½®çš„AI_API_KEYæ³¨å…¥åˆ°æ­¤æ­¥éª¤çš„ç¯å¢ƒå˜é‡
        env:
          AI_API_KEY: ${{ secrets.AI_API_KEY }}
        run: node generate-content.js # è¿è¡Œæˆ‘ä»¬çš„è„šæœ¬

      - name: ğŸ’¾ æäº¤æ›´æ–°
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add data/today.json
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å˜åŠ¨ï¼Œæœ‰åˆ™æäº¤
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°: $(date +'%Y-%m-%d') çš„å…»ç”Ÿå†…å®¹" && git push)
